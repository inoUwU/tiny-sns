// Tiny SNS (Twitter-like) core schema
// Focus: MVP data model for timelines, interactions, and moderation.

Project "tiny-sns" {
  database_type: "PostgreSQL"
  note: "Twitter-like SNS core schema for study"
}

Table users {
  id uuid [pk]
  handle varchar [unique, not null, note: "@username"]
  display_name varchar [not null]
  email varchar [unique, not null]
  password_hash varchar [not null]
  status varchar [not null, default: 'active']
  created_at timestamptz [not null, default: `now()`]
  updated_at timestamptz [not null, default: `now()`]
}

Table user_profiles {
  user_id uuid [pk, ref: > users.id]
  bio text
  location varchar
  website varchar
  avatar_media_id uuid [ref: > media.id]
  header_media_id uuid [ref: > media.id]
  birth_date date
  updated_at timestamptz [not null, default: `now()`]
}

Table posts {
  id uuid [pk]
  author_id uuid [not null, ref: > users.id]
  text text [not null]
  reply_to_post_id uuid [ref: > posts.id]
  quote_post_id uuid [ref: > posts.id]
  visibility varchar [not null, default: 'public', note: "public/unlisted/followers/private"]
  created_at timestamptz [not null, default: `now()`]
  updated_at timestamptz [not null, default: `now()`]
  deleted_at timestamptz
}

Table media {
  id uuid [pk]
  owner_id uuid [not null, ref: > users.id]
  media_type varchar [not null, note: "image/video"]
  url varchar [not null]
  width int
  height int
  duration_seconds int
  created_at timestamptz [not null, default: `now()`]
}

Table post_media {
  post_id uuid [not null, ref: > posts.id]
  media_id uuid [not null, ref: > media.id]
  position int [not null]

  Indexes {
    (post_id, media_id) [unique]
  }
}

Table follows {
  follower_id uuid [not null, ref: > users.id]
  followee_id uuid [not null, ref: > users.id]
  status varchar [not null, default: 'accepted', note: "pending/accepted"]
  created_at timestamptz [not null, default: `now()`]

  Indexes {
    (follower_id, followee_id) [unique]
  }
}

Table likes {
  user_id uuid [not null, ref: > users.id]
  post_id uuid [not null, ref: > posts.id]
  created_at timestamptz [not null, default: `now()`]

  Indexes {
    (user_id, post_id) [unique]
  }
}

Table reposts {
  user_id uuid [not null, ref: > users.id]
  post_id uuid [not null, ref: > posts.id]
  created_at timestamptz [not null, default: `now()`]

  Indexes {
    (user_id, post_id) [unique]
  }
}

Table bookmarks {
  user_id uuid [not null, ref: > users.id]
  post_id uuid [not null, ref: > posts.id]
  created_at timestamptz [not null, default: `now()`]

  Indexes {
    (user_id, post_id) [unique]
  }
}

Table hashtags {
  id uuid [pk]
  tag varchar [unique, not null]
  created_at timestamptz [not null, default: `now()`]
}

Table post_hashtags {
  post_id uuid [not null, ref: > posts.id]
  hashtag_id uuid [not null, ref: > hashtags.id]

  Indexes {
    (post_id, hashtag_id) [unique]
  }
}

Table mentions {
  post_id uuid [not null, ref: > posts.id]
  mentioned_user_id uuid [not null, ref: > users.id]

  Indexes {
    (post_id, mentioned_user_id) [unique]
  }
}

Table notifications {
  id uuid [pk]
  recipient_id uuid [not null, ref: > users.id]
  actor_id uuid [ref: > users.id]
  notification_type varchar [not null, note: "follow/like/repost/reply/mention/quote"]
  post_id uuid [ref: > posts.id]
  created_at timestamptz [not null, default: `now()`]
  read_at timestamptz
}

Table blocks {
  blocker_id uuid [not null, ref: > users.id]
  blocked_id uuid [not null, ref: > users.id]
  created_at timestamptz [not null, default: `now()`]

  Indexes {
    (blocker_id, blocked_id) [unique]
  }
}

Table mutes {
  muter_id uuid [not null, ref: > users.id]
  muted_id uuid [not null, ref: > users.id]
  created_at timestamptz [not null, default: `now()`]

  Indexes {
    (muter_id, muted_id) [unique]
  }
}
